{"version":3,"file":"json-patch.min.js","sources":["../src/json-patch.js"],"names":["jsonpatch","_equals","a","b","_isArray","length","i","l","bKeys","_objectKeys","bLength","isInteger","str","charCode","len","charCodeAt","apply","tree","patches","patch","result","p","plen","keys","path","split","obj","t","undefined","value","op","Error","from","index","parseInt","arrOps","call","key","indexOf","replace","objOps","rootOps","Object","o","hasOwnProperty","push","add","this","remove","move","temp","copy","test","_get","arr","splice","JSON","stringify","Array","isArray","exports"],"mappings":"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","sourcesContent":["/*!\r\n* json-patch-duplex.js 0.4.1\r\n* (c) 2013 Joachim Wester\r\n* MIT license\r\n*/\r\nvar jsonpatch;\r\n(function (jsonpatch) {\r\n    /* Do nothing if module is already defined.\r\n    Doesn't look nice, as we cannot simply put\r\n    `!jsonpatch &&` before this immediate function call\r\n    in TypeScript.\r\n    */\r\n    if (jsonpatch.apply) {\r\n        return;\r\n    }\r\n\r\n    var _objectKeys = (function () {\r\n        if (Object.keys)\r\n            return Object.keys;\r\n\r\n        return function (o) {\r\n            var keys = [];\r\n            for (var i in o) {\r\n                if (o.hasOwnProperty(i)) {\r\n                    keys.push(i);\r\n                }\r\n            }\r\n            return keys;\r\n        };\r\n    })();\r\n\r\n    function _equals(a, b) {\r\n        switch (typeof a) {\r\n            case 'undefined':\r\n            case 'boolean':\r\n            case 'string':\r\n            case 'number':\r\n                return a === b;\r\n            case 'object':\r\n                if (a === null)\r\n                    return b === null;\r\n                if (_isArray(a)) {\r\n                    if (!_isArray(b) || a.length !== b.length)\r\n                        return false;\r\n\r\n                    for (var i = 0, l = a.length; i < l; i++)\r\n                        if (!_equals(a[i], b[i]))\r\n                            return false;\r\n\r\n                    return true;\r\n                }\r\n\r\n                var bKeys = _objectKeys(b);\r\n                var bLength = bKeys.length;\r\n                if (_objectKeys(a).length !== bLength)\r\n                    return false;\r\n\r\n                for (var i = 0; i < bLength; i++)\r\n                    if (!_equals(a[i], b[i]))\r\n                        return false;\r\n\r\n                return true;\r\n\r\n            default:\r\n                return false;\r\n        }\r\n    }\r\n\r\n    /* We use a Javascript hash to store each\r\n    function. Each hash entry (property) uses\r\n    the operation identifiers specified in rfc6902.\r\n    In this way, we can map each patch operation\r\n    to its dedicated function in efficient way.\r\n    */\r\n    /* The operations applicable to an object */\r\n    var objOps = {\r\n        add: function (obj, key) {\r\n            obj[key] = this.value;\r\n            return true;\r\n        },\r\n        remove: function (obj, key) {\r\n            delete obj[key];\r\n            return true;\r\n        },\r\n        replace: function (obj, key) {\r\n            obj[key] = this.value;\r\n            return true;\r\n        },\r\n        move: function (obj, key, tree) {\r\n            var temp = { op: \"_get\", path: this.from };\r\n            apply(tree, [temp]);\r\n            apply(tree, [\r\n                { op: \"remove\", path: this.from }\r\n            ]);\r\n            apply(tree, [\r\n                { op: \"add\", path: this.path, value: temp.value }\r\n            ]);\r\n            return true;\r\n        },\r\n        copy: function (obj, key, tree) {\r\n            var temp = { op: \"_get\", path: this.from };\r\n            apply(tree, [temp]);\r\n            apply(tree, [\r\n                { op: \"add\", path: this.path, value: temp.value }\r\n            ]);\r\n            return true;\r\n        },\r\n        test: function (obj, key) {\r\n            return _equals(obj[key], this.value);\r\n        },\r\n        _get: function (obj, key) {\r\n            this.value = obj[key];\r\n        }\r\n    };\r\n\r\n    /* The operations applicable to an array. Many are the same as for the object */\r\n    var arrOps = {\r\n        add: function (arr, i) {\r\n            if (i > arr.length) {\r\n                throw new Error(\"The specified index MUST NOT be greater than the number of elements in the array.\");\r\n            }\r\n            arr.splice(i, 0, this.value);\r\n            return true;\r\n        },\r\n        remove: function (arr, i) {\r\n            arr.splice(i, 1);\r\n            return true;\r\n        },\r\n        replace: function (arr, i) {\r\n            arr[i] = this.value;\r\n            return true;\r\n        },\r\n        move: objOps.move,\r\n        copy: objOps.copy,\r\n        test: objOps.test,\r\n        _get: objOps._get\r\n    };\r\n\r\n    /* The operations applicable to object root. Many are the same as for the object */\r\n    var rootOps = {\r\n        add: function (obj) {\r\n            rootOps.remove.call(this, obj);\r\n            for (var key in this.value) {\r\n                if (this.value.hasOwnProperty(key)) {\r\n                    obj[key] = this.value[key];\r\n                }\r\n            }\r\n            return true;\r\n        },\r\n        remove: function (obj) {\r\n            for (var key in obj) {\r\n                if (obj.hasOwnProperty(key)) {\r\n                    objOps.remove.call(this, obj, key);\r\n                }\r\n            }\r\n            return true;\r\n        },\r\n        replace: function (obj) {\r\n            apply(obj, [\r\n                { op: \"remove\", path: this.path }\r\n            ]);\r\n            apply(obj, [\r\n                { op: \"add\", path: this.path, value: this.value }\r\n            ]);\r\n            return true;\r\n        },\r\n        move: objOps.move,\r\n        copy: objOps.copy,\r\n        test: function (obj) {\r\n            return (JSON.stringify(obj) === JSON.stringify(this.value));\r\n        },\r\n        _get: objOps._get\r\n    };\r\n\r\n    var _isArray;\r\n    if (Array.isArray) {\r\n        _isArray = Array.isArray;\r\n    } else {\r\n        _isArray = function (obj) {\r\n            return obj.push && typeof obj.length === 'number';\r\n        };\r\n    }\r\n\r\n    //3x faster than cached /^\\d+$/.test(str)\r\n    function isInteger(str) {\r\n        var i = 0;\r\n        var len = str.length;\r\n        var charCode;\r\n        while (i < len) {\r\n            charCode = str.charCodeAt(i);\r\n            if (charCode >= 48 && charCode <= 57) {\r\n                i++;\r\n                continue;\r\n            }\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n\r\n    /// Apply a json-patch operation on an object tree\r\n    function apply(tree, patches) {\r\n        var result = false, p = 0, plen = patches.length, patch;\r\n        while (p < plen) {\r\n            patch = patches[p];\r\n            p++;\r\n\r\n            // Find the object\r\n            var keys = patch.path.split('/');\r\n            var obj = tree;\r\n            var t = 1;\r\n            var len = keys.length;\r\n\r\n            if (patch.value === undefined && (patch.op === \"add\" || patch.op === \"replace\" || patch.op === \"test\")) {\r\n                throw new Error(\"'value' MUST be defined\");\r\n            }\r\n            if (patch.from === undefined && (patch.op === \"copy\" || patch.op === \"move\")) {\r\n                throw new Error(\"'from' MUST be defined\");\r\n            }\r\n\r\n            while (true) {\r\n                if (_isArray(obj)) {\r\n                    var index;\r\n                    if (keys[t] === '-') {\r\n                        index = obj.length;\r\n                    } else if (isInteger(keys[t])) {\r\n                        index = parseInt(keys[t], 10);\r\n                    } else {\r\n                        throw new Error(\"Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index\");\r\n                    }\r\n                    t++;\r\n                    if (t >= len) {\r\n                        result = arrOps[patch.op].call(patch, obj, index, tree); // Apply patch\r\n                        break;\r\n                    }\r\n                    obj = obj[index];\r\n                } else {\r\n                    var key = keys[t];\r\n                    if (key !== undefined) {\r\n                        if (key && key.indexOf('~') != -1)\r\n                            key = key.replace(/~1/g, '/').replace(/~0/g, '~'); // escape chars\r\n                        t++;\r\n                        if (t >= len) {\r\n                            result = objOps[patch.op].call(patch, obj, key, tree); // Apply patch\r\n                            break;\r\n                        }\r\n                    } else {\r\n                        t++;\r\n                        if (t >= len) {\r\n                            result = rootOps[patch.op].call(patch, obj, key, tree); // Apply patch\r\n                            break;\r\n                        }\r\n                    }\r\n                    obj = obj[key];\r\n                }\r\n            }\r\n        }\r\n        return result;\r\n    }\r\n    jsonpatch.apply = apply;\r\n})(jsonpatch || (jsonpatch = {}));\r\n\r\nif (typeof exports !== \"undefined\") {\r\n    exports.apply = jsonpatch.apply;\r\n}\r\n"]}